{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="shortcut icon" href="https://unpkg.com/leaflet/dist/images/marker-icon.png" type="image/x-icon">
	<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <title>Weather</title>
</head>
<body>
    {{ user.username }}
    <a href="/logout/">logout</a>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Save</button>
        </form>

        <hr>
    
    <div class="column is-offset-4 is-4">

        <img class="leagueimg" src="/media/default/thermometer_green.png" alt="" style="width: 100px; height: auto;">

        {% for weather in weather_data %}
        <div class="box">
            <article class="media">
                <div class="media-content">
                    <div class="content">
                        <p>
                            {% for city in cities %}
                            {% if weather.name|lower == city.name|lower %}
                            <a href="{% url 'update' pk=city.pk %}">{{ city.name }}</a>
                            {% endif %}
                            {% endfor %}
                            <br>
                            <span class="subtitle">Temperature: {{ weather.temperature }}° C,</span>
                            <span class="subtitle"> Humidity: {{ weather.humidity }}° C</span>
                            <br>{{ weather.description }}

                            <!-- {% if weather.temperature > 40 %}
                                <img class="leagueimg" src="/media/default/thermometer_red.png" alt="" style="width: 100px; height: auto;">

                            {% elif weather.temperature > 28 %}
                                <img class="leagueimg" src="/media/default/thermometer_black.png" alt="" style="width: 100px; height: auto;">

                            {% elif weather.temperature > 0 %}
                                <img class="leagueimg" src="/media/default/thermometer_green.png" alt="" style="width: 100px; height: auto;">
                            
                            {% endif %} -->
                        </p>
                    </div>
                </div>
            </article>
        </div>
        {% endfor %}

    </div>
    <div id="map" style="width: 100%; height: 300px;"></div>

	<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
	<script>
		var mymap = L.map('map').setView([20.5937, 78.9629], 3); // Set view to India

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(mymap);

		// Access cities variable passed from Python
		var cities = {{ weather_data | safe }};

		// Add markers for each city
		cities.forEach(function(city) {
            // console.log(city.lat, city.lon)
            var popupContent = "<b>" + city.name + "</b><br>" +
                       "Temperature: " + city.temperature + "<br>" +
                       "Humidity: " + city.humidity;
			L.marker([city.lat, city.lon]).addTo(mymap)
				.bindPopup(popupContent)
				// .openPopup();
		});
	</script>
    
</body>
</html>


<!-- <script>
        // Initialize an empty object to store weather data
let weatherData = {};

// Function to fetch weather data from the API
async function fetchWeatherData(city) {
    const apiKey = 'your_api_key';
    const apiUrl = `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city}`;
    
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching weather data:', error);
        return null;
    }
}

// Function to handle city click event
async function handleCityClick(city) {
    if (weatherData[city]) {
        // If weather data for this city is already fetched, display it
        displayWeatherDetails(weatherData[city]);
    } else {
        // If weather data is not available, fetch it
        const data = await fetchWeatherData(city);
        if (data) {
            // Store the data and display it
            weatherData[city] = data;
            displayWeatherDetails(data);
        }
    }
}

// Function to display weather details
function displayWeatherDetails(data) {
    // Display weather details on your page
    console.log('Weather details:', data);
}

    </script> -->